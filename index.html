<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #27ae60;
            --bg-light: #f4f7f6;
        }
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: transparent; /* Ubah ke transparent agar menyatu dengan Google Sites */
            margin: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
        }
        .login-container {
            background: white;
            padding: 40px;
            border-radius: 12px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
            width: 90%;
            max-width: 400px;
        }
        .header { text-align: center; margin-bottom: 30px; }
        .header h2 { color: var(--primary-color); margin: 0; font-size: 24px; }
        .header p { color: #7f8c8d; font-size: 14px; margin-top: 5px; }
        
        .form-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; font-weight: 600; font-size: 14px; color: #333; }
        input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-sizing: border-box;
            font-size: 14px;
        }
        input:focus { border-color: var(--secondary-color); outline: none; }
        
        .btn-login {
            width: 100%;
            padding: 14px;
            background-color: var(--primary-color);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-weight: bold;
            font-size: 16px;
            transition: 0.3s;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .btn-login:disabled { background-color: #95a5a6; cursor: not-allowed; }
        
        #message {
            margin-top: 15px;
            text-align: center;
            font-size: 13px;
            min-height: 20px;
        }

        /* Loading Spinner */
        .loader {
            display: none;
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--secondary-color);
            border-radius: 50%;
            width: 18px;
            height: 18px;
            animation: spin 1s linear infinite;
            margin-left: 10px;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
    </style>
</head>
<body>

<div class="login-container">
    <div class="header">
        <h2>Login Alumni</h2>
        <p>Akses Layanan SiLaNi terStudy</p>
    </div>

    <form id="loginForm">
        <div class="form-group">
            <label>NIM/Username</label>
            <input type="text" id="nim" placeholder="Masukkan NIM/Username Anda" required>
        </div>

        <div class="form-group">
            <label>Password</label>
            <input type="password" id="password" placeholder="Masukkan Password" required>
        </div>

        <button type="submit" class="btn-login" id="loginBtn">
            <span id="btnText">Masuk Ke Sistem</span>
            <div class="loader" id="loader"></div>
        </button>
    </form>
    
    <div id="message"></div>

    <div style="text-align: center; margin-top: 25px; font-size: 14px; color: #666;">
        Alumni baru / Belum punya akun? <a href="daftar.html" style="color: var(--secondary-color); text-decoration: none; font-weight: bold;">Buat Akun</a>
    </div>
</div>

<script>
    // URL Web App dari Apps Script Anda
    const webAppUrl = "https://script.google.com/macros/s/AKfycbxJGAMLgAOEvonsTz4AGnc7GTSnbFUF_Ag-sDdWJ_PjigtlsTM7qc1mDOOHz0w_NqIY/exec";

    document.getElementById('loginForm').addEventListener('submit', function(e) {
        e.preventDefault();
        
        const btn = document.getElementById('loginBtn');
        const btnText = document.getElementById('btnText');
        const loader = document.getElementById('loader');
        const msg = document.getElementById('message');
        
        const nimValue = document.getElementById('nim').value;
        const passValue = document.getElementById('password').value;

        // UI Feedback: Loading
        btn.disabled = true;
        btnText.innerText = "Memverifikasi...";
        loader.style.display = "block";
        msg.innerText = "";

        // Hit API Backend menggunakan GET sesuai doGet(e) di Apps Script
        fetch(`${webAppUrl}?nim=${encodeURIComponent(nimValue)}&password=${encodeURIComponent(passValue)}`)
        .then(response => response.json())
        .then(data => {
            if(data.result === "success") {
                msg.style.color = "green";
                msg.innerHTML = `<b>Login Berhasil!</b><br>Halo, ${data.user.nama}. Mengalihkan...`;
                
                // Simpan Session
                localStorage.setItem('userSiLaNi', JSON.stringify(data.user));
                
                // Redirect ke Dashboard
               // Redirect ke Dashboard
setTimeout(() => {
    const dashboardUrl = "dashboard.html";
    
    try {
        if(data.result === "success") {
    msg.style.color = "green";
    msg.innerHTML = `<b>Login Berhasil!</b><br>Halo, ${data.user.nama}.<br><a href="dashboard.html" target="_top" style="color:blue; font-weight:bold;">Klik di sini jika tidak otomatis pindah</a>`;
    
    localStorage.setItem('userSiLaNi', JSON.stringify(data.user));

    // Eksekusi redirect otomatis
    setTimeout(() => {
        window.top.location.href = "dashboard.html";
    }, 1500);
}
        // Upaya 1: Mengubah URL jendela utama
        if (window.top) {
            window.top.location.href = dashboardUrl;
        } else {
            window.location.href = dashboardUrl;
        }
    } catch (e) {
        // Upaya 2: Jika diblokir oleh Sandbox, buka di tab baru atau paksa ganti
        console.error("Redirect diblokir browser, mencoba metode alternatif...");
        window.open(dashboardUrl, "_top");
    }
}, 1500);
            } else {
                msg.style.color = "#e74c3c";
                msg.innerText = data.message; // Menampilkan "NIM atau Password salah!"
                resetBtn();
            }
        })
        .catch(err => {
            msg.style.color = "#e74c3c";
            msg.innerText = "Gagal terhubung ke server. Pastikan internet stabil.";
            console.error(err);
            resetBtn();
        });

        function resetBtn() {
            btn.disabled = false;
            btnText.innerText = "Masuk Ke Sistem";
            loader.style.display = "none";
        }
    });
</script>

</body>
</html>
